<div id="text">

</div>

<script>

String.prototype.format = function() {

var args = arguments;

return this.replace(/{(\d+)}/g, function(match, number) { 

  return typeof args[number] != 'undefined'

    ? args[number]

    : match

  ;

});

};

var screen=document.getElementById('text');

screen.style.width='800px';

screen.style.height='400px';

screen.style.whiteSpace='pre';

screen.style.fontSize='2em';

var lines=['def fun():','    print text','    return 0'];

var x=0;

var y=0;

var key=0;

var mode='Normal';

function onkey(e){

	if(mode=='Insert'){

		on_insert(e);

	}else{

		on_normal(e);

	}

	display();

}

function on_normal(e){

	key=e.keyCode;

	if(key==72){ //H

		if(x>0)x-=1;

	}else if(key==76){ //L

		if(x<lines[y].length-1)x+=1;

	}else if(key==74){ //J

		if(y<lines.length-1)y+=1

	}else if(key==75){ //K

		if(y>0)y-=1

	}else if(key==88){ //X

		lines[y]=lines[y].substr(0,x)+lines[y].substr(x+1);

	}else if(key==73){ //I

		mode='Insert';

	}else if(key==27){ //I

		mode='Normal';

	}

}

function on_insert(e){

	key=e.keyCode;

	if(key==27){ //I

		mode='Normal';

	}if(key==13){ //enter

		t=lines[y].substr(x);

		console.log(t);

		lines[y]=lines[y].substr(0,x);

		lines.splice(y+1,0,t);

		y+=1;

	}else if(key==8){ //backspace

		if(x>0)lines[y]=lines[y].substr(0,x)+lines[y].substr(x+1);

		if(x>0)x-=1;

	}else{

		lines[y]=lines[y].substr(0,x)+String.fromCharCode(key).toLowerCase()+lines[y].substr(x);

		x+=1;

	}

}

document.addEventListener("keyup", onkey);

function display(){

	var n=lines.length;

	var html='';

	html+='(Mode {3})(Line {0},Col {1},Key {2})\n'.format(y,x,key,mode);

	for(var i =0;i<n;i++){

		var line=lines[i];

		if (i==y){

			line=line.substr(0,x)+'<span style="background-color:gray">'+line.substr(x,1)+'</span>'+line.substr(x+1);

		}

		html+=i+line+'\n';

	}

	for(var i=n;i<20;i++){

		html+='<br>';

	}

	

	screen.innerHTML=html;

}

display();

screen.focus();



</script>
